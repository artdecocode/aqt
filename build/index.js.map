{"version":3,"sources":["../src/index.js"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["import { request as https } from 'https'\nimport { request as http } from 'http'\nimport { debuglog } from 'util'\nimport erotic from 'erotic'\nimport { parse } from 'url'\nimport { version } from '../package.json'\nimport { getData, exec } from './lib'\n\nconst LOG = debuglog('aqt')\n\n/**\n * Request a web page and return information including `headers`, `statusCode`, `statusMessage` along with the `body` (which is also parsed if JSON received).\n * @param {string} address The URL such as http://example.com/api.\n * @param {AqtOptions} [options] Configuration for requests.\n * @param {Object} options.data Optional data to send to the server with the request.\n * @param {'form'|'json'} [options.type=\"'json'\"] How to send data: `json` to serialise JSON data and `form` for url-encoded transmission with `json` mode by default. Default `'json'`.\n * @param {OutgoingHttpHeaders} [options.headers] Headers to use for the request.\n * @param {boolean} [options.compress=true] Add the `Accept-Encoding: gzip, deflate` header automatically to indicate to the server that it can send a compressed response. Default `true`.\n * @param {string} [options.headers=\"POST\"] What HTTP method to use to send data. Default `POST`.\n * @param {boolean} [options.binary=false] Whether to return a buffer instead of a string. Default `false`.\n * @param {boolean} [options.justHeaders=false] Whether to stop the request after response headers were received, without waiting for the data. Default `false`.\n * @returns {Promise.<AqtReturn>} The body, headers and status.\n */\nconst aqt = async (address, options = {}) => {\n  const {\n    data: d,\n    type = 'json',\n    headers: outgoingHeaders = {\n      'User-Agent': `Mozilla/5.0 (Node.js) aqt/${version}`,\n    },\n    compress = true,\n    binary = false,\n    method = 'POST',\n    justHeaders = false,\n  } = options\n  const er = erotic(true)\n\n  const { hostname, protocol, port, path } = parse(address)\n  const isHttps = protocol === 'https:'\n  const request = isHttps ? https : http\n\n  const opts = {\n    hostname,\n    port,\n    path,\n    headers: {\n      ...outgoingHeaders,\n    },\n  }\n\n  let data\n  if (d) {\n    const _d = getData(type, d)\n      ; ({ data } = _d)\n    const { contentType } = _d\n\n    opts.method = method\n    opts.headers['Content-Type'] = contentType\n    opts.headers['Content-Length'] = Buffer.byteLength(data)\n  }\n  if (compress) {\n    opts.headers['Accept-Encoding'] = 'gzip, deflate'\n  }\n\n  const {\n    body, headers, byteLength, statusCode, statusMessage, rawLength,\n    parsedBody,\n  } = await exec(request, opts, {\n    data,\n    justHeaders,\n    binary,\n    er,\n  })\n\n  LOG('%s %s B%s', address, byteLength, `${byteLength != rawLength ? ` (raw ${rawLength} B)` : ''}`)\n\n  return {\n    body: parsedBody ? parsedBody : body,\n    headers,\n    statusCode,\n    statusMessage,\n  }\n}\n\nexport default aqt\n\n/* documentary types/index.xml */\n/**\n * @typedef {import('http').OutgoingHttpHeaders} OutgoingHttpHeaders\n *\n * @typedef {Object} AqtOptions Configuration for requests.\n * @prop {Object} data Optional data to send to the server with the request.\n * @prop {'form'|'json'} [type=\"'json'\"] How to send data: `json` to serialise JSON data and `form` for url-encoded transmission with `json` mode by default. Default `'json'`.\n * @prop {OutgoingHttpHeaders} [headers] Headers to use for the request.\n * @prop {boolean} [compress=true] Add the `Accept-Encoding: gzip, deflate` header automatically to indicate to the server that it can send a compressed response. Default `true`.\n * @prop {string} [headers=\"POST\"] What HTTP method to use to send data. Default `POST`.\n * @prop {boolean} [binary=false] Whether to return a buffer instead of a string. Default `false`.\n * @prop {boolean} [justHeaders=false] Whether to stop the request after response headers were received, without waiting for the data. Default `false`.\n */\n\n\n/* documentary types/return.xml */\n/**\n * @typedef {import('http').IncomingHttpHeaders} IncomingHttpHeaders\n *\n * @typedef {Object} AqtReturn\n * @prop {string|object|Buffer} body The return from the server. In case the `json` content-type was set by the server, the response will be parsed into an object. If `binary` option was used for the request, a `Buffer` will be returned. Otherwise, a string response is returned.\n * @prop {IncomingHttpHeaders} headers Incoming headers returned by the server.\n * @prop {number} statusCode The status code returned by the server.\n * @prop {string} statusMessage The status message set by the server.\n */\n"]}